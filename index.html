<html>

<head>
    <title>Testnet CCD drop</title>
</head>
<style>
    html {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
</style>
<script>
    function onGetCcdClicked() {
        let addressInput = document.getElementById("address")
        let getCcdButton = document.getElementById("get-ccd-button")
        let statusSpan = document.getElementById("status")
        let address = addressInput.value.trim()

        if (address.length == 0) {
            return
        }

        getCcdButton.disabled = true
        statusSpan.innerText = "⌛"

        fetch(
            "https://wallet-proxy.testnet.concordium.com/v0/testnetGTUDrop/" + address,
            {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error("HTTP error: " + response.status);
                }
                return response.json();
            })
            .then(submissionResult => {
                let submissionId = submissionResult["submissionId"]
                return fetch("https://wallet-proxy.testnet.concordium.com/v0/submissionStatus/" + submissionId)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("HTTP error: " + response.status);
                        }
                        return response.json();
                    })
            })
            .then(submissionStatus => {
                let amount = submissionStatus["amount"] / 1000000.0
                let hash = submissionStatus["transactionHash"]
                statusSpan.innerText = "✅ " + amount + " CCD (" + hash + ")"

                getCcdButton.disabled = false
            })
            .catch(error => {
                statusSpan.innerText = "⚠️ Failed: " + error

                getCcdButton.disabled = false
            });
    }
</script>

<body>
    <h1>Testnet CCD drop</h1>

    <input type="text" id="address" placeholder="Paste your Concordium Testnet address" />

    <button id="get-ccd-button" onclick="onGetCcdClicked()">Get CCD</button>
    <br>
    <p>
        <span id="status"></span>
    </p>
</body>

</html>